# Copyright (c) Meta Platforms, Inc. and affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.

load("//antlir/bzl:third_party.bzl", "third_party")
load("//antlir/bzl/image/feature:defs.bzl", "feature")

oncall("twimage")

third_party.build(
    name = "libcrypto",
    src = third_party.source("openssl_1.1.1k"),
    features = [
        feature.rpms_install([
            # build deps
            "gcc",
            "autoconf",
            "autoconf-archive",
            "libtool",
            "make",
        ]),
    ],
    script = third_party.script(
        build = "make",
        install = "make install",
        prepare = """
export CFLAGS="-fPIC -fno-omit-frame-pointer"

./config --prefix="${OUTPUT}" \
    enable-camellia enable-seed enable-rfc3779 enable-cms enable-md2 \
    no-mdc2 no-ec2m no-sm2 no-sm4 \
    no-zlib \
    no-rc5 no-ec2m no-gost no-sm3 no-idea no-whirlpool \
    no-shared
        """,
    ),
    visibility = ["//antlir/third-party/..."],
)
