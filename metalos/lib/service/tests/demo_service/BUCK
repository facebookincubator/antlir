load("//metalos:defs.bzl", "rust_binary")
load("//metalos/bzl/service:service.bzl", "native_service")

rust_binary(
    name = "demo-service",
    srcs = glob(["src/**/*.rs"]),
    unittests = False,
    deps = [
        "anyhow",
        "nix",
        "structopt",
        # @oss-disable: "//metalos/lib/service/tests/demo_service/facebook:facebook_checks", 
    ],
)

native_service(
    name = "layer",
    binary = ":demo-service",
    generator_binary = "//metalos/lib/service/tests/demo_service/generator:generator",
    service_binary_path = "/usr/bin/demo",
    service_name = "metalos.service.demo",
    systemd_service_unit = "metalos.service.demo.service",
    visibility = ["//metalos/lib/service/..."],
)
