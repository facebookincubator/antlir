load("//antlir/bzl:image.bzl", "image")
load("//metalos:defs.bzl", "default_test_layer")

image.layer(
    name = "test-layer",
    parent_layer = default_test_layer(),
    features = [
        image.ensure_subdirs_exist("/test-control-subvol", "image/service"),
        image.ensure_subdirs_exist("/test-control-subvol/image/service", "metalos.demo:00000000000040008000000000000001"),
        image.ensure_subdirs_exist("/test-control-subvol/image/service", "metalos.demo:00000000000040008000000000000002"),
        image.ensure_subdirs_exist("/test-control-subvol/image/service", "metalos.demo:00000000000040008000000000000003"),
        image.layer_mount("//metalos/lib/service/tests/demo_service:layer", "/test-control-subvol/image/service/metalos.demo:00000000000040008000000000000001/volume"),
        image.layer_mount("//metalos/lib/service/tests/demo_service:layer", "/test-control-subvol/image/service/metalos.demo:00000000000040008000000000000002/volume"),
        image.layer_mount("//metalos/lib/service/tests/demo_service:layer", "/test-control-subvol/image/service/metalos.demo:00000000000040008000000000000003/volume"),
    ],
)
