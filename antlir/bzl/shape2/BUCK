load("//antlir/bzl:build_defs.bzl", "buck_filegroup", "rust_binary", "rust_library")
load("//antlir/bzl:tool.bzl", "antlir_tool")

oncall("twimage")

rust_library(
    name = "ir",
    srcs = ["ir.rs"],
    deps = [
        "anyhow",
        "derive_more",
        "serde",
        "serde_json",
    ],
)

antlir_tool(
    rust_binary,
    name = "bzl2ir",
    srcs = ["bzl2ir.rs"],
    crate = "bzl2ir",
    test_deps = ["maplit"],
    visibility = ["PUBLIC"],
    deps = [
        "anyhow",
        "derive_more",
        "gazebo",
        "serde",
        "serde_json",
        "slotmap",
        "starlark",
        "structopt",
        ":ir",
    ],
)

antlir_tool(
    rust_binary,
    name = "ir2code",
    srcs = ["ir2code.rs"],
    visibility = ["PUBLIC"],
    deps = [
        "anyhow",
        "clap",
        "derive_more",
        "handlebars",
        "itertools",
        "serde",
        "serde_json",
        ":ir",
    ],
)

buck_filegroup(
    name = "templates",
    srcs = glob(["templates/*.handlebars"]),
    visibility = ["PUBLIC"],
)

rust_library(
    name = "shape",
    srcs = ["shape.rs"],
    visibility = ["PUBLIC"],
    deps = [
        "anyhow",
        "fbthrift",
        "serde",
    ],
)
